define(function(require){var app=require("./app");require("./comFilter"),require("./directive"),require("./utils"),app.controller("homeCtrl",["$scope","$rootScope","$state","utils",function($scope,$rootScope,$state,utils){function createOrder(e){console.log(e),$rootScope.loading=!0;var o={clientSource:clientSource,subSource:subSource,phone:$scope.obj.mobile,itemId:e.itemId,itemPrice:e.price,face:e.face,openid:"",resultUrl:location.origin+"?clientSource="+clientSource+"&subSource"+subSource+"&phone="+$scope.obj.mobile,type:e.type,areaLimit:e.areaLimit,timeLimit:e.timeLimit};app.get("CreateOrder").create(o).success(function(e){if($rootScope.loading=!1,"0000"===e.status)return console.log(e),void(window.location.href=e.payUrl);switch(e.status){case"-1":utils.toast(e.retMsg||"系统异常");break;case"0001":utils.toast(e.retMsg||"流量包不存在");break;case"0002":utils.toast(e.retMsg||"此渠道不存在此流量包");break;case"0003":utils.toast(e.retMsg||"流量包价格不正确");break;case"0004":utils.toast(e.retMsg||"提交支付失败");break;case"0005":utils.toast(e.retMsg||"流量包不存在");break;default:utils.toast(e.retMsg||"系统异常")}}).error(function(){$state.go("error")})}$scope.goBack=function(){window.history.back()},window.onBack=function(){$scope.goBack()},$scope.obj={mobile:"",carrier:"",model:"0",selectedItem:null};var parse=utils.urlparse(),clientSource=parse.clientSource,subSource=parse.subSource;$scope.obj.mobile=parse.phone,$scope.select=function(item){$scope.obj.selectedItem=item;for(var i=0;i<$scope.obj.selectedItem.length;i++){var desc=$scope.obj.selectedItem[i].simpleDesc;$scope.obj.selectedItem[i].simpleDesc=eval("'"+desc+"'")}},$scope.recharge=function(e){var o=$scope.obj.mobile;if(!o||""==o)return void utils.toast("请输入手机号码");for(var t=0;t<$scope.obj.selectedItem.length;t++)if(e===$scope.obj.selectedItem[t].type){createOrder($scope.obj.selectedItem[t]);break}},window.checkMobile=function(e,o){/[^\d]/.test(e.value)&&(e.value=e.value.replace(/[^\d]/g,"")),e.value.length>o&&(e.value=e.value.substr(0,o)),e.value.length<3&&($scope.obj.carrier="")},$scope.getInitInfo=function(){var e=$scope.obj.mobile;if(""==e||e&&11===e.length){$rootScope.loading=!0;var o={clientSource:clientSource,subSource:subSource,phone:e||"15813848805"};app.get("InitInfo").get(o).success(function(e){if($rootScope.loading=!1,console.log(e),$scope.obj.carrier=e.carrier,e.isSuccess){$scope.obj.itemList=e.itemList,$scope.obj.model="0";for(var o in e.itemList){$scope.select(e.itemList[o]);break}}else utils.toast(e.retMsg)}).error(function(){$state.go("error")})}},$scope.getInitInfo(),utils.browser().onePlus&&!sessionStorage.getItem("onceReload")&&(window.location.reload(),sessionStorage.setItem("onceReload",!0))}]).controller("questionCtrl",["$scope","$rootScope",function(e,o){e.goBack=function(){window.history.back()},window.onBack=function(){e.goBack()},o.loading=!1}]).controller("tipsCtrl",["$scope","$rootScope",function(e,o){e.goBack=function(){window.history.back()},window.onBack=function(){e.goBack()},o.loading=!1}]).controller("detailGCtrl",["$scope","$rootScope",function(e,o){e.goBack=function(){window.history.back()},window.onBack=function(){e.goBack()},o.loading=!1}]).controller("detailPCtrl",["$scope","$rootScope",function(e,o){e.goBack=function(){window.history.back()},window.onBack=function(){e.goBack()},o.loading=!1}]).controller("errorCtrl",["$scope","$rootScope","utils",function(e,o,t){e.goBack=function(){},window.onBack=function(){e.goBack()},o.loading=!1}]).controller("listCtrl",["$scope","$rootScope","$state","utils",function(e,o,t,c){function i(i,r){e.finish=!1,o.loading=!0,app.get("rechargeListService").get(i,r).success(function(i){o.loading=!1,c.toast(i.returnMsg),"00"==i.resultCode?(i.data.length>0&&(e.list=e.list.concat(i.data)),e.finish=!0):t.go("error")}).error(function(){t.go("error")})}e.goBack=function(){window.history.back()},window.onBack=function(){e.goBack()},e.list=[],e.finish=!1;var r=1,s=10;i(r,s),document.querySelector(".showList").addEventListener("scroll",function(){this.scrollHeight-this.clientHeight-this.scrollTop<70&&e.finish&&(r++,i(r,s))})}])});
